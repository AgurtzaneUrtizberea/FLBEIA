{
    "contents" : "##==============================================================================\n#               FINAL  Myfish Simulations June 2015 (Paris)\n#                     TRADITIONAL FLEET DYNAMCICS\n#\n# o 4 Scenarios:\n#     * 2013-2015: HISTORICAL TAC (trad.hist)\n#     * 2015-2025:\n#         * NO LANDING OBLIGATION:  \n#               - MSY reference point - NO LAND.OBLI:   ices.trad\n#               - MSMSY reference point - NO LAND.OBLI: msmsy.trad\n#         * LANDING OBLIGATION:\n#               - MSY reference point - NO LAND.OBLI:   ices_lo.trad\n#               - MSMSY reference point - NO LAND.OBLI: msmsy_lo.trad\n#\n# Dorleta Garcia \n#         \n# 2015/06/11\n#==============================================================================\n\n\nrm(list=ls())\n\n#==============================================================================\n# Section 1:            Load libraries\n#==============================================================================\n\nlibrary(FLCore) \nlibrary(FLAssess)\nlibrary(FLash)\nlibrary(nloptr)\nlibrary(FLFleet)\nlibrary(FLBEIA) \n\n\nlibrary(devtools)\n\n#==============================================================================\n# Section 2:            Set directory, Load Objects.\n#==============================================================================\n\n    \nscriptnm <- 'Final_Trad_HKE'\n\n\n\n\n iter <- as.numeric(Sys.getenv(\"SGE_TASK_ID\"))\n\n#iter <- 1\n#setwd('c:/use/google drive/MyFish/FLBEIA/')\n\n load(file.path(\"input\", paste(\"Myfish_\",iter,\".RData\", sep = \"\")))\n\n# load(file.path(\"data/gridDataSets\", paste(\"MyFish_\",iter,\".RData\", sep = \"\")))\n\nscriptnm <- 'Trad_HKE'\n\nmain.ctrl[[1]][2] <- '2025'\n\noutputPath = file.path(\"output\", paste(\"res\",scriptnm,\"_\",iter,\".RData\", sep = \"\"))\n\n\n##==============================================================================\n##  Section 3:       Run FLBEIA\n##==============================================================================\n#\n\n\n# change spanish trawlers effort restrictor.\nfleets.ctrl.trad$DTS_SP$effort.restr <- 'HKE'\nfleets.ctrl.mpro$DTS_SP$effort.restr <- 'HKE'\n\n# 0. histTAC_trad\nmain.ctrl_histTAC <- main.ctrl\nmain.ctrl_histTAC[[1]][2] <- 2015\nhistTAC_trad <- FLBEIA(biols = biols, SRs = SRs, BDs = NULL, fleets=fleets, covars = covars,\n                       indices = NULL, advice = advice, main.ctrl = main.ctrl_histTAC,\n                       biols.ctrl = biols.ctrl, fleets.ctrl = fleets.ctrl.trad,\n                       covars.ctrl = covars.ctrl, obs.ctrl = obs.ctrl,\n                       assess.ctrl = assess.ctrl, advice.ctrl = advice.ctrl.fixed)\n\n\n\n# 1. ices_trad\nbiols  <- histTAC_trad$biols\nfleets <- histTAC_trad$fleets\ncovars <- histTAC_trad$covars\nadvice <- histTAC_trad$advice \nfor(st in names(SRs)) SRs[[st]]@ssb[,ac(2013:2016)] <- ssb(biols[[st]])[,ac(2013:2016)]\n\n\nices.trad  <- FLBEIA(biols = biols, SRs = SRs, BDs = NULL, fleets=fleets, covars = covars,\n                   indices = NULL, advice = advice, main.ctrl = main.ctrl,\n                   biols.ctrl = biols.ctrl, fleets.ctrl = fleets.ctrl.trad,\n                   covars.ctrl = covars.ctrl, obs.ctrl = obs.ctrl,\n                   assess.ctrl = assess.ctrl, advice.ctrl = advice.ctrl.ices)\n\nmsmsy.trad <- FLBEIA(biols = biols, SRs = SRs, BDs = NULL, fleets=fleets, covars = covars,\n                    indices = NULL, advice = advice, main.ctrl = main.ctrl,\n                    biols.ctrl = biols.ctrl, fleets.ctrl = fleets.ctrl.trad,\n                    covars.ctrl = covars.ctrl, obs.ctrl = obs.ctrl,\n                    assess.ctrl = assess.ctrl, advice.ctrl = advice.ctrl.msmsy)\n\nices_lo.trad  <- FLBEIA(biols = biols, SRs = SRs, BDs = NULL, fleets=fleets, covars = covars,\n                     indices = NULL, advice = advice, main.ctrl = main.ctrl,\n                     biols.ctrl = biols.ctrl, fleets.ctrl = fleets.ctrl.trad_lo,\n                     covars.ctrl = covars.ctrl, obs.ctrl = obs.ctrl,\n                     assess.ctrl = assess.ctrl, advice.ctrl = advice.ctrl.ices_lo)\n\nmsmsy_lo.trad <- FLBEIA(biols = biols, SRs = SRs, BDs = NULL, fleets=fleets, covars = covars,\n                     indices = NULL, advice = advice, main.ctrl = main.ctrl,\n                     biols.ctrl = biols.ctrl, fleets.ctrl = fleets.ctrl.trad_lo,\n                     covars.ctrl = covars.ctrl, obs.ctrl = obs.ctrl,\n                     assess.ctrl = assess.ctrl, advice.ctrl = advice.ctrl.msmsy_lo)\n\n\n#==============================================================================\n#  Section 4:       Summaries\n#==============================================================================\nscnms <-  c('ices.trad', 'msmsy.trad', 'ices_lo.trad', 'msmsy_lo.trad')\n\n\nscnms_long <- scnms\nnames(scnms_long) <- scnms\n\nlast.yr <- main.ctrl[[1]][2]\n\nbio <- eco <- catchFl <- catchMt <- effortMt <-  bioStd <- bioyr <- NULL\nfor(sc in scnms){\n  print(sc)\n  \n  bio      <- rbind(bio, cbind(bioSum(get(sc), years = ac(2010:last.yr)), scenario = sc))\n  if(sc != 'fixed') covars <- get(sc)$covars\n  eco      <- rbind(eco, cbind(ecoSum(get(sc)$fleets, 'all', ac(2010:last.yr), covars), scenario = sc))\n  catchFl  <- rbind(catchFl, cbind(catchFlSum(get(sc)$fleets, get(sc)$advice, 'all', 'all', ac(2010:last.yr)), scenario = sc))\n  catchMt  <- rbind(catchMt, cbind(catchMtSum(get(sc)$fleets, 'all', 'all', ac(2010:last.yr)), scenario = sc))\n  effortMt <- rbind(effortMt, cbind(effortMtSum(get(sc)$fleets, 'all',  ac(2010:last.yr)), scenario = sc))\n  \n  bioyr  <- subset(bio, year > 2009 & scenario == sc)\n  bioStd <- rbind(bioStd, subset(bioyr, indicator %in% c('ssb', 'rec', 'f', 'catch') & stock %in% c('HKE', 'MEG', 'MON', 'LDB', 'HOM') & scenario == sc))\n  \n  for(ind in  c('ssb', 'rec', 'f', 'catch')){\n    for(st in c('HKE', 'MEG', 'MON', 'LDB', 'HOM')){\n      xx <- subset(bioyr, indicator == ind & stock == st)$value\n      bioStd[bioStd$indicator == ind & bioStd$stock == st  & bioStd$scenario == sc,'value'] <- (xx - mean(xx))/sd(xx)\n    }}\n  \n}\n\n\nsave(bio, eco,catchFl,  catchMt, effortMt, bioStd, file = outputPath)\n\n",
    "created" : 1448541582413.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2684948166",
    "id" : "BFA33AE3",
    "lastKnownWriteTime" : 1435058836,
    "path" : "~/escritorio/Myfish_Trad_HKE_Final_Runs.R",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}